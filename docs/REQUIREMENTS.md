# è¦ä»¶å®šç¾©æ›¸

> VCA Server - Voice Cognition Authentication Server

## æ¦‚è¦

éŸ³å£°ã«ã‚ˆã‚‹äºŒè¦ç´ èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã€‚ãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚ºï¼ˆçŸ¥è­˜èªè¨¼ï¼‰ã¨å£°ç´‹ï¼ˆç”Ÿä½“èªè¨¼ï¼‰ã‚’çµ„ã¿åˆã‚ã›ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è­˜åˆ¥ãƒ»èªè¨¼ã™ã‚‹ã€‚

## èªè¨¼æ–¹å¼

| èªè¨¼è¦ç´      | ç¨®é¡ž                      | å½¹å‰²             | åˆ¤å®šåŸºæº–                      |
| ------------ | ------------------------- | ---------------- | ----------------------------- |
| ãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚º | çŸ¥è­˜èªè¨¼ï¼ˆWhat you knowï¼‰ | ä¸»è¦ãªèªè¨¼è¦ç´    | æ–‡å­—èµ·ã“ã—çµæžœã® **å®Œå…¨ä¸€è‡´** |
| å£°ç´‹         | ç”Ÿä½“èªè¨¼ï¼ˆWhat you areï¼‰  | è£œåŠ©çš„ãªèªè¨¼è¦ç´  | é¡žä¼¼åº¦ãŒã—ãã„å€¤ä»¥ä¸Š          |

### èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯

```
èªè¨¼æˆåŠŸæ¡ä»¶ = ãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚ºå®Œå…¨ä¸€è‡´ AND å£°ç´‹é¡žä¼¼åº¦ â‰§ ã—ãã„å€¤
```

| ãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚º | å£°ç´‹ | çµæžœ         |
| ------------ | ---- | ------------ |
| ä¸€è‡´         | OK   | **èªè¨¼æˆåŠŸ** |
| ä¸€è‡´         | NG   | **èªè¨¼å¤±æ•—** |
| ä¸ä¸€è‡´       | -    | **èªè¨¼å¤±æ•—** |

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ       | æŠ€è¡“           |
| -------------------- | -------------- |
| ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯       | FastAPI        |
| ã‚¿ã‚¹ã‚¯ã‚­ãƒ¥ãƒ¼         | Celery         |
| ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ–ãƒ­ãƒ¼ã‚«ãƒ¼ | Redis          |
| æ–‡å­—èµ·ã“ã—           | faster-whisper |
| å£°ç´‹æŠ½å‡º             | WeSpeaker      |
| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹         | PostgreSQL     |
| ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸           | GCS / ãƒ­ãƒ¼ã‚«ãƒ« |
| å‡¦ç†æ–¹å¼             | åŒæœŸå‡¦ç†       |

## èªè¨¼ãƒ•ãƒ­ãƒ¼

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼éŸ³å£°å…¥åŠ›
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. æ–‡å­—èµ·ã“ã—ï¼ˆfaster-whisperï¼‰      â”‚
â”‚     â†’ ãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚ºæŠ½å‡º               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. å£°ç´‹æŠ½å‡ºï¼ˆWeSpeakerï¼‰             â”‚
â”‚     â†’ 256æ¬¡å…ƒç‰¹å¾´é‡ãƒ™ã‚¯ãƒˆãƒ«ç”Ÿæˆ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. èªè¨¼åˆ¤å®š                          â”‚
â”‚     â”œâ”€ ãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚ºä¸€è‡´ï¼Ÿ â†’ å¿…é ˆ     â”‚
â”‚     â””â”€ å£°ç´‹é¡žä¼¼åº¦ï¼Ÿ â†’ è£œåŠ©çš„         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
   èªè¨¼çµæžœï¼ˆæˆåŠŸ / å¤±æ•—ï¼‰
```

## æ©Ÿèƒ½è¦ä»¶

| ID   | æ©Ÿèƒ½           | èª¬æ˜Ž                                   |
| ---- | -------------- | -------------------------------------- |
| FR-1 | è©±è€…ç™»éŒ²       | speaker_idã€ãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚ºã€å£°ç´‹ã‚’ç™»éŒ²   |
| FR-2 | æ–‡å­—èµ·ã“ã—     | faster-whisperã§éŸ³å£°â†’ãƒ†ã‚­ã‚¹ãƒˆå¤‰æ›      |
| FR-3 | ãƒ†ã‚­ã‚¹ãƒˆæ­£è¦åŒ– | å°æ–‡å­—åŒ–ã€å¥èª­ç‚¹é™¤åŽ»ã€ç©ºç™½æ­£è¦åŒ–       |
| FR-4 | å£°ç´‹æŠ½å‡º       | WeSpeakerã§256æ¬¡å…ƒãƒ™ã‚¯ãƒˆãƒ«æŠ½å‡º         |
| FR-5 | å£°ç´‹ç…§åˆ       | ã‚³ã‚µã‚¤ãƒ³é¡žä¼¼åº¦ã§ã—ãã„å€¤åˆ¤å®š           |
| FR-6 | èªè¨¼åˆ¤å®š       | ãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚ºä¸€è‡´ AND å£°ç´‹OK ã§æˆåŠŸ     |
| FR-7 | è©±è€…è­˜åˆ¥       | ç™»éŒ²æ¸ˆã¿è©±è€…ã‹ã‚‰æœ€ã‚‚é¡žä¼¼ã™ã‚‹è©±è€…ã‚’ç‰¹å®š |
| FR-8 | ãƒ‡ãƒ¢ç”»é¢       | éŸ³å£°ç™»éŒ²ãƒ»èªè¨¼ã®ãƒ‡ãƒ¢UIï¼ˆ1ç”»é¢ï¼‰        |

## ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

```
faster-whisper
wespeakerruntime
numpy
```

## éžæ©Ÿèƒ½è¦ä»¶

| é …ç›®       | è¦ä»¶                         |
| ---------- | ---------------------------- |
| ã‚¹ã‚±ãƒ¼ãƒ«   | å€‹äººåˆ©ç”¨ï¼ˆã‚¹ã‚±ãƒ¼ãƒ«è¦ä»¶ãªã—ï¼‰ |
| å‡¦ç†æ–¹å¼   | åŒæœŸå‡¦ç†                     |
| ãƒ¬ã‚¹ãƒãƒ³ã‚¹ | æ•°ç§’ä»¥å†…                     |
| å¯¾å¿œè¨€èªž   | æ—¥æœ¬èªž                       |

---

# è¨­è¨ˆ

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚³ãƒ³ãƒ†ãƒŠæ§‹æˆ

| ã‚³ãƒ³ãƒ†ãƒŠ   | å½¹å‰²                 | ä¸»è¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸                    |
| ---------- | -------------------- | --------------------------------- |
| vca_api    | REST API             | FastAPI                           |
| vca_worker | éŸ³å£°å‡¦ç†ãƒ¯ãƒ¼ã‚«ãƒ¼     | Celery, faster-whisper, WeSpeaker |
| Redis      | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ–ãƒ­ãƒ¼ã‚«ãƒ¼ | -                                 |
| PostgreSQL | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹         | -                                 |

### ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹æˆ

| ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ | å½¹å‰²                                       |
| ---------- | ------------------------------------------ |
| vca_core   | ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã€ãƒ¢ãƒ‡ãƒ«ã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ |
| vca_api    | REST APIï¼ˆFastAPIï¼‰ã€ãƒ‡ãƒ¢ç”»é¢              |
| vca_infra  | DB/ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®Ÿè£…                          |
| vca_worker | éŸ³å£°å‡¦ç†ã‚¿ã‚¹ã‚¯ï¼ˆCeleryï¼‰                   |

### å‡¦ç†ãƒ•ãƒ­ãƒ¼ï¼ˆè©±è€…ç™»éŒ²ï¼‰

```
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  vca_apiï¼ˆAPIã‚³ãƒ³ãƒ†ãƒŠï¼‰                                  â”‚
â”‚  1. ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡                                       â”‚
â”‚  2. éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜                         â”‚
â”‚  3. Celeryã‚¿ã‚¹ã‚¯å‘¼ã³å‡ºã—ï¼ˆåŒæœŸå¾…ã¡ï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚                                              â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  Redisï¼ˆãƒ–ãƒ­ãƒ¼ã‚«ãƒ¼ï¼‰â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  vca_workerï¼ˆWorkerã‚³ãƒ³ãƒ†ãƒŠï¼‰                            â”‚
â”‚  4. æ–‡å­—èµ·ã“ã—ï¼ˆfaster-whisperï¼‰                         â”‚
â”‚  5. å£°ç´‹æŠ½å‡ºï¼ˆWeSpeakerï¼‰                                â”‚
â”‚  6. çµæžœã‚’è¿”å´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  vca_apiï¼ˆAPIã‚³ãƒ³ãƒ†ãƒŠï¼‰                                  â”‚
â”‚  7. Passphrase/Voiceprintã‚’DBã«ä¿å­˜                      â”‚
â”‚  8. ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¿”å´                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
```

### Celeryã‚¿ã‚¹ã‚¯

| ã‚¿ã‚¹ã‚¯å           | å…¥åŠ›        | å‡ºåŠ›                      | èª¬æ˜Ž                       |
| ------------------ | ----------- | ------------------------- | -------------------------- |
| transcribe         | audio_bytes | strï¼ˆæ–‡å­—èµ·ã“ã—ãƒ†ã‚­ã‚¹ãƒˆï¼‰ | faster-whisperã§æ–‡å­—èµ·ã“ã— |
| extract_voiceprint | audio_bytes | bytesï¼ˆ256æ¬¡å…ƒãƒ™ã‚¯ãƒˆãƒ«ï¼‰  | WeSpeakerã§å£°ç´‹æŠ½å‡º        |

### vca_worker æ§‹æˆ

```
vca_worker/
  __init__.py
  celery_app.py           # Celeryã‚¢ãƒ—ãƒªè¨­å®š
  tasks/
    __init__.py
    transcription.py      # æ–‡å­—èµ·ã“ã—ã‚¿ã‚¹ã‚¯
    voiceprint.py         # å£°ç´‹æŠ½å‡ºã‚¿ã‚¹ã‚¯
  services/
    __init__.py
    transcription_service.py  # faster-whisper wrapper
    voiceprint_service.py     # WeSpeaker wrapper
```

## ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

```
Speaker (1) â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (N) VoiceSample
   â†‘                            â†‘
   â”œâ”€â”€ (N) Voiceprint â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                            â”‚
   â””â”€â”€ (N) Passphrase â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              (æœ€å¤§3ã¤)
```

### Speaker

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰   | åž‹          | èª¬æ˜Ž           |
| ------------ | ----------- | -------------- |
| id           | int         | PK             |
| public_id    | str         | å…¬é–‹ID         |
| speaker_id   | str         | ãƒ¦ãƒ¼ã‚¶ãƒ¼è­˜åˆ¥å­ |
| speaker_name | str \| None | è©±è€…å         |
| created_at   | datetime    | ä½œæˆæ—¥æ™‚       |
| updated_at   | datetime    | æ›´æ–°æ—¥æ™‚       |

### VoiceSample

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰      | åž‹          | èª¬æ˜Ž               |
| --------------- | ----------- | ------------------ |
| id              | int         | PK                 |
| public_id       | str         | å…¬é–‹ID             |
| speaker_id      | int         | FK to Speaker      |
| audio_file_path | str         | éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹   |
| audio_format    | str         | éŸ³å£°ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆ   |
| sample_rate     | int \| None | ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ãƒ¬ãƒ¼ãƒˆ |
| channels        | int \| None | ãƒãƒ£ãƒ³ãƒãƒ«æ•°       |
| created_at      | datetime    | ä½œæˆæ—¥æ™‚           |

### Voiceprint

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰      | åž‹       | èª¬æ˜Ž                    |
| --------------- | -------- | ----------------------- |
| id              | int      | PK                      |
| public_id       | str      | å…¬é–‹ID                  |
| speaker_id      | int      | FK to Speaker           |
| voice_sample_id | int      | FK to VoiceSample       |
| embedding       | bytes    | å£°ç´‹ãƒ™ã‚¯ãƒˆãƒ«ï¼ˆ256æ¬¡å…ƒï¼‰ |
| created_at      | datetime | ç™»éŒ²æ—¥æ™‚                |

### Passphrase

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰      | åž‹       | èª¬æ˜Ž                   |
| --------------- | -------- | ---------------------- |
| id              | int      | PK                     |
| public_id       | str      | å…¬é–‹ID                 |
| speaker_id      | int      | FK to Speaker          |
| voice_sample_id | int      | FK to VoiceSample      |
| phrase          | str      | æ­£è¦åŒ–æ¸ˆã¿ãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚º |
| created_at      | datetime | ç™»éŒ²æ—¥æ™‚               |

â€» Passphraseã¯1äººã®Speakerã«ã¤ãæœ€å¤§3ã¤ã¾ã§ç™»éŒ²å¯èƒ½

## API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹                    | èª¬æ˜Ž                                           |
| -------- | ----------------------- | ---------------------------------------------- |
| POST     | `/api/v1/auth/register` | è©±è€…ç™»éŒ²ï¼ˆéŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ« + ãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚º + å£°ç´‹ï¼‰ |
| POST     | `/api/v1/auth/verify`   | èªè¨¼ï¼ˆ1:1ç…§åˆï¼‰                                |
| POST     | `/api/v1/auth/identify` | è­˜åˆ¥ï¼ˆ1:Nç…§åˆï¼‰                                |

## API è©³ç´°

### POST /api/v1/auth/register

è©±è€…ã®ç™»éŒ²ã€‚éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã€ãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚ºã¨å£°ç´‹ã‚’æŠ½å‡ºã—ã¦ä¿å­˜ã™ã‚‹ã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**

```json
{
  "speaker_id": "user123",
  "speaker_name": "å±±ç”°å¤ªéƒŽ",
  "audio_data": "base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸéŸ³å£°ãƒ‡ãƒ¼ã‚¿",
  "audio_format": "wav"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**

```json
{
  "speaker_id": "user123",
  "speaker_name": "å±±ç”°å¤ªéƒŽ",
  "voice_sample_id": "vs_abc123",
  "voiceprint_id": "vp_xyz789",
  "passphrase": "ã“ã‚“ã«ã¡ã¯ä¸–ç•Œ",
  "status": "registered"
}
```

### POST /api/v1/auth/verify

1:1èªè¨¼ã€‚æŒ‡å®šã—ãŸè©±è€…ã¨ã®ç…§åˆã‚’è¡Œã†ã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**

```json
{
  "speaker_id": "user123",
  "audio_data": "base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸéŸ³å£°ãƒ‡ãƒ¼ã‚¿",
  "audio_format": "wav"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**

```json
{
  "authenticated": true,
  "speaker_id": "user123",
  "passphrase_match": true,
  "voice_similarity": 0.85,
  "message": "èªè¨¼æˆåŠŸ"
}
```

### POST /api/v1/auth/identify

1:Nè­˜åˆ¥ã€‚ç™»éŒ²æ¸ˆã¿è©±è€…ã®ä¸­ã‹ã‚‰æœ€ã‚‚é¡žä¼¼ã™ã‚‹è©±è€…ã‚’ç‰¹å®šã™ã‚‹ã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**

```json
{
  "audio_data": "base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸéŸ³å£°ãƒ‡ãƒ¼ã‚¿",
  "audio_format": "wav"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**

```json
{
  "identified": true,
  "speaker_id": "user123",
  "speaker_name": "å±±ç”°å¤ªéƒŽ",
  "passphrase_match": true,
  "voice_similarity": 0.85,
  "message": "è­˜åˆ¥æˆåŠŸ"
}
```

## ãƒ‡ãƒ¢ç”»é¢ï¼ˆFR-8ï¼‰

### æ¦‚è¦

éŸ³å£°èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®å‹•ä½œç¢ºèªç”¨ãƒ‡ãƒ¢UIã€‚1ç”»é¢ã§ç™»éŒ²ãƒ»èªè¨¼ã®ä¸¡æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã§ãã‚‹ã€‚

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| æŠ€è¡“        | ç”¨é€”                            |
| ----------- | ------------------------------- |
| htmx        | éžåŒæœŸãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã€éƒ¨åˆ†DOMæ›´æ–° |
| TailwindCSS | ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ï¼ˆCDNçµŒç”±ï¼‰         |
| Jinja2      | ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°        |
| Web Audio   | ãƒžã‚¤ã‚¯éŒ²éŸ³ï¼ˆMediaRecorder APIï¼‰ |

### æ©Ÿèƒ½è¦ä»¶

| ID     | æ©Ÿèƒ½                 | èª¬æ˜Ž                                      |
| ------ | -------------------- | ----------------------------------------- |
| FR-8-1 | éŸ³å£°å…¥åŠ›ï¼ˆãƒžã‚¤ã‚¯ï¼‰   | ãƒ–ãƒ©ã‚¦ã‚¶ã®MediaRecorder APIã§éŒ²éŸ³         |
| FR-8-2 | éŸ³å£°å…¥åŠ›ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ | wav/mp3/m4aç­‰ã®éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ |
| FR-8-3 | è©±è€…ç™»éŒ²ãƒ‡ãƒ¢         | speaker_idå…¥åŠ› + éŸ³å£°ã§ç™»éŒ²APIã‚’å‘¼ã³å‡ºã—  |
| FR-8-4 | èªè¨¼ãƒ‡ãƒ¢             | speaker_idå…¥åŠ› + éŸ³å£°ã§èªè¨¼APIã‚’å‘¼ã³å‡ºã—  |
| FR-8-5 | çµæžœè¡¨ç¤º             | ç™»éŒ²/èªè¨¼çµæžœã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç”»é¢ã«è¡¨ç¤º   |

### ç”»é¢æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VCA Voice Auth Demo                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   éŸ³å£°å…¥åŠ›æ–¹æ³•       â”‚    â”‚   è©±è€…æƒ…å ±          â”‚        â”‚
â”‚  â”‚ â—‹ ãƒžã‚¤ã‚¯å…¥åŠ›        â”‚    â”‚ Speaker ID: [____] â”‚        â”‚
â”‚  â”‚ â—‹ ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰â”‚    â”‚ Name: [____]       â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚           [ðŸŽ¤ éŒ²éŸ³é–‹å§‹] / [ðŸ“ ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠž]       â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚    ðŸ“ ç™»éŒ²       â”‚  â”‚    ðŸ” èªè¨¼       â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚                    çµæžœè¡¨ç¤º                      â”‚        â”‚
â”‚  â”‚  - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ / ãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚º / å£°ç´‹é¡žä¼¼åº¦        â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹             | èª¬æ˜Ž                     |
| -------- | ---------------- | ------------------------ |
| GET      | `/demo/`         | ãƒ‡ãƒ¢ç”»é¢è¡¨ç¤º             |
| POST     | `/demo/register` | ç™»éŒ²ãƒ‡ãƒ¢ï¼ˆHTMLéƒ¨åˆ†è¿”å´ï¼‰ |
| POST     | `/demo/verify`   | èªè¨¼ãƒ‡ãƒ¢ï¼ˆHTMLéƒ¨åˆ†è¿”å´ï¼‰ |

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
packages/vca_api/vca_api/
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ demo/
â”‚       â”œâ”€â”€ index.html           # ãƒ¡ã‚¤ãƒ³ç”»é¢
â”‚       â””â”€â”€ partials/
â”‚           â””â”€â”€ result.html      # çµæžœè¡¨ç¤ºï¼ˆhtmxéƒ¨åˆ†æ›´æ–°ç”¨ï¼‰
â”œâ”€â”€ static/
â”‚   â””â”€â”€ js/
â”‚       â””â”€â”€ audio.js             # ãƒžã‚¤ã‚¯éŒ²éŸ³ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†
â””â”€â”€ routes/
    â”œâ”€â”€ auth.py
    â””â”€â”€ demo.py                  # ãƒ‡ãƒ¢ç”¨ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
```

### æ³¨æ„äº‹é …

- ãƒžã‚¤ã‚¯å…¥åŠ›ã¯HTTPSç’°å¢ƒï¼ˆã¾ãŸã¯localhostï¼‰ã§ã®ã¿å‹•ä½œ
- MediaRecorderã¯é€šå¸¸ `webm` å½¢å¼ã§éŒ²éŸ³
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã¯Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ã¦APIã«é€ä¿¡

## ãƒ†ã‚­ã‚¹ãƒˆæ­£è¦åŒ–ãƒ«ãƒ¼ãƒ«

ãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚ºã®æ¯”è¼ƒæ™‚ã«é©ç”¨ã™ã‚‹æ­£è¦åŒ–å‡¦ç†:

1. **å°æ–‡å­—åŒ–**: å¤§æ–‡å­—â†’å°æ–‡å­—ã«å¤‰æ›
2. **å¥èª­ç‚¹é™¤åŽ»**: å¥èª­ç‚¹ãƒ»è¨˜å·ã‚’å‰Šé™¤
3. **ç©ºç™½æ­£è¦åŒ–**: é€£ç¶šç©ºç™½â†’å˜ä¸€ç©ºç™½ã€å‰å¾Œã®ç©ºç™½ã‚’ãƒˆãƒªãƒ 

```python
def normalize_text(text: str) -> str:
    import re
    text = text.lower()
    text = re.sub(r'[^\w\s]', '', text)
    text = ' '.join(text.split())
    return text
```

**ä¾‹:**

| å…¥åŠ›                   | æ­£è¦åŒ–å¾Œ           |
| ---------------------- | ------------------ |
| `"Hello, World!"`      | `"hello world"`    |
| `"ã“ã‚“ã«ã¡ã¯ã€ä¸–ç•Œï¼"` | `"ã“ã‚“ã«ã¡ã¯ä¸–ç•Œ"` |
| `"  test   test  "`    | `"test test"`      |

## å£°ç´‹ç…§åˆã®è©³ç´°

### WeSpeaker

- **ãƒ¢ãƒ‡ãƒ«**: ResNet34ï¼ˆVoxCeleb/CNCelebã§äº‹å‰å­¦ç¿’æ¸ˆã¿ï¼‰
- **å‡ºåŠ›**: 256æ¬¡å…ƒã®ç‰¹å¾´é‡ãƒ™ã‚¯ãƒˆãƒ«
- **é¡žä¼¼åº¦è¨ˆç®—**: ã‚³ã‚µã‚¤ãƒ³é¡žä¼¼åº¦
- **ã—ãã„å€¤**: 0.5ï¼ˆèª¿æ•´å¯èƒ½ï¼‰
- **GitHub**: https://github.com/wenet-e2e/wespeaker

```python
import wespeakerruntime as wespeaker
import numpy as np

# ãƒ¢ãƒ‡ãƒ«ã®ãƒ­ãƒ¼ãƒ‰ï¼ˆè¨€èªž: 'en' or 'chs'ï¼‰
speaker = wespeaker.Speaker(lang='en')

# å£°ç´‹æŠ½å‡º
embedding = speaker.extract_embedding('audio.wav')  # shape: (256,)

# é¡žä¼¼åº¦è¨ˆç®—
score = speaker.compute_cosine_score(embedding1, embedding2)
is_same_speaker = score >= 0.5
```
