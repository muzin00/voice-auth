<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VCA Voice Auth Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <style>
        .htmx-indicator {
            display: none;
        }
        .htmx-request .htmx-indicator {
            display: flex;
        }
        .htmx-request.htmx-indicator {
            display: flex;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-3xl">
        <h1 class="text-4xl font-bold text-center text-gray-800 mb-2">
            VCA Voice Auth Demo
        </h1>
        <p class="text-center text-gray-600 mb-8">
            音声認証システムのデモンストレーション
        </p>

        <!-- 話者情報セクション -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4 text-gray-800">話者情報</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-gray-700 mb-2 font-medium">
                        Speaker ID <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="speaker-id" required
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="例: user123">
                    <p class="text-sm text-gray-500 mt-1">話者を一意に識別するIDを入力してください</p>
                </div>
                <div>
                    <label class="block text-gray-700 mb-2 font-medium">
                        Name (オプション)
                    </label>
                    <input type="text" id="speaker-name"
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="例: 山田太郎">
                </div>
            </div>
        </div>

        <!-- 音声入力セクション -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4 text-gray-800">音声入力</h2>

            <!-- 入力方法の選択 -->
            <div class="flex gap-4 mb-6">
                <label class="flex items-center cursor-pointer">
                    <input type="radio" name="input_method" value="mic"
                           checked onchange="toggleInputMethod('mic')"
                           class="mr-2 w-4 h-4 text-blue-600">
                    <span class="text-gray-700">🎤 マイク入力</span>
                </label>
                <label class="flex items-center cursor-pointer">
                    <input type="radio" name="input_method" value="file"
                           onchange="toggleInputMethod('file')"
                           class="mr-2 w-4 h-4 text-blue-600">
                    <span class="text-gray-700">📁 ファイルアップロード</span>
                </label>
            </div>

            <!-- マイク入力UI -->
            <div id="mic-input" class="space-y-4">
                <button id="record-btn" onclick="toggleRecording()"
                        class="w-full bg-red-500 hover:bg-red-600 text-white
                               font-bold py-4 px-6 rounded-lg transition duration-200
                               flex items-center justify-center gap-2">
                    <span class="text-2xl">🎤</span>
                    <span>録音開始</span>
                </button>
                <div id="recording-status" class="text-center text-gray-600 min-h-6"></div>
            </div>

            <!-- ファイル入力UI -->
            <div id="file-input" class="hidden">
                <input type="file" id="audio-file" accept="audio/*"
                       onchange="handleFileSelect()"
                       class="w-full p-3 border border-gray-300 rounded-lg
                              file:mr-4 file:py-2 file:px-4 file:rounded-lg
                              file:border-0 file:text-sm file:font-semibold
                              file:bg-blue-50 file:text-blue-700
                              hover:file:bg-blue-100 cursor-pointer">
                <p class="text-sm text-gray-500 mt-2">対応形式: wav, mp3, m4a, webm, ogg 等</p>
                <div id="file-status" class="text-center text-gray-600 mt-2"></div>
            </div>
        </div>

        <!-- アクションボタン -->
        <div class="grid grid-cols-2 gap-4 mb-6">
            <button onclick="submitAction('register')"
                    class="bg-blue-500 hover:bg-blue-600 text-white
                           font-bold py-4 px-6 rounded-lg transition duration-200
                           flex items-center justify-center gap-2 shadow-lg">
                <span class="text-xl">📝</span>
                <span>登録</span>
            </button>
            <button onclick="submitAction('verify')"
                    class="bg-green-500 hover:bg-green-600 text-white
                           font-bold py-4 px-6 rounded-lg transition duration-200
                           flex items-center justify-center gap-2 shadow-lg">
                <span class="text-xl">🔐</span>
                <span>認証</span>
            </button>
        </div>

        <!-- 結果表示エリア (htmxで更新) -->
        <div id="result" class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold mb-4 text-gray-800">結果</h2>
            <p class="text-gray-500 text-center py-8">音声を登録または認証してください</p>
        </div>

        <!-- 使い方ヘルプ -->
        <div class="mt-8 bg-blue-50 border border-blue-200 rounded-lg p-4">
            <h3 class="font-semibold text-blue-900 mb-2">💡 使い方</h3>
            <ol class="text-sm text-blue-800 space-y-1 list-decimal list-inside">
                <li>Speaker IDを入力（例: user123）</li>
                <li>音声を録音またはファイルを選択</li>
                <li>「登録」ボタンで話者を登録</li>
                <li>同じSpeaker IDで再度音声を入力し「認証」ボタンでテスト</li>
            </ol>
        </div>
    </div>

    <!-- 隠しフォーム (htmx用) -->
    <form id="action-form" class="hidden"
          hx-swap="innerHTML"
          hx-target="#result"
          hx-indicator="#loading">
        <input type="hidden" name="speaker_id" id="form-speaker-id">
        <input type="hidden" name="speaker_name" id="form-speaker-name">
        <input type="hidden" name="audio_data" id="form-audio-data">
        <input type="hidden" name="audio_format" id="form-audio-format">
    </form>

    <!-- ローディングインジケーター -->
    <div id="loading" class="htmx-indicator fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 flex flex-col items-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mb-4"></div>
            <p class="text-gray-700 font-semibold">処理中...</p>
        </div>
    </div>

    <script src="/static/js/audio.js"></script>
</body>
</html>
